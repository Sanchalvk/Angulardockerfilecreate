name: Build and Push Docker Image
on:
 push:
  branches: [main]
  tags: 
    - 'v*.*.*'
   
env:
   DOCKER_REPO: sanchalkhedkar/asas

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Extract version
        run: |
          VERSION=$(jq -r '.version' package.json)
          echo "APP_VERSION=$VERSION" >> $GITHUB_ENV

      - name: Log in to DockerHub
        run: echo "dckr_pat_yC7BqB9FPf8d_ZT9M_A4dktjrWo" | docker login -u "sanchalkhedkar" --password-stdin

      - name: Build and tag Docker image
        run: |
          echo "Building Docker image with tag: $DOCKER_REPO:$APP_VERSION"
          docker build -t $DOCKER_REPO:$APP_VERSION .
          docker tag $DOCKER_REPO:$APP_VERSION $DOCKER_REPO:latest

      - name: Push Docker image
        run: |
         docker push your-docker-repo/your-image-name:${{ steps.version.outputs.APP_VERSION }}
         docker push your-docker-repo/your-image-name:latest

